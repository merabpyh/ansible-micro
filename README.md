# ansible-micro
for minimal ci\cd https://github.com/merabpyh/webprog

## Usage
TASK TAGS: [build, check, checkout, deploy, rollback, setup, test]
ansible-playbook mainbook.yml --tags=setup
Запускать следует от пользователя обладающего sudo привилегиями и главной группой docker.

--tags=setup - установка зависимостей, клонирование репозитория локально, запуск proxy

--tags=build - сборка проекта с последующей сборкой и тестированием образ контейнера

--tags=deploy - запуск контейнеров с приложением, запуская после build обновит версию приложения

--tags=rollback - запускать объявляя версию приложения

--tags=test - проверка сборки образа приложения с запуском\выключением тестового контейнера

--tags=check - проверка работы контейнера при deploy\rollback

--tags=checkout - склонирование репозитория

Изветные проблемы:
- необходимость передавать sudo пароль
- организовывать связь до хоста - ssh пароль или доступ по сертификату
- завести пользователя с главной группой docker и правами sudo
- архитектурная проблема, при старте контейнера в java стартует spring обвязка - до 3-5 секунд,
что требует паузы перед проверкой и ведёт к неизбежному простою (решается переписыванием приложения на GO например)
- build:
    - при повторных вызовах будет переставиться докер из скрипта - добавить хендлер
- deploy:
    - при первом запуске двойная пересборка контейнера прода
- rollback:
    - необходимость предопределять вручную версию отката из имеющихся тегов образов контейнеров
